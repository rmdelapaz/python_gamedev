<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Master component systems in game architecture. Learn Entity-Component-System (ECS) patterns for flexible, reusable game objects.">
    <title>Component Systems - Game Architecture</title>
    <link rel="stylesheet" href="/styles/main.css">
    <link rel="stylesheet" href="/styles/enhanced.css">
    <link rel="icon" href="/favicon.png">
    <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
      mermaid.initialize({ startOnLoad: true });
    </script>
</head>
<body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-to-main">Skip to main content</a>
    
    <!-- Progress indicator -->
    <div class="progress-indicator" role="progressbar" aria-label="Page scroll progress">
        <div class="progress-bar"></div>
    </div>
    
    <main id="main-content">
    <header role="banner">
        <h1>Component Systems</h1>
        <div class="reading-time" aria-label="Estimated reading time"></div>
    </header>
    
    <!-- Breadcrumb Navigation -->
    <nav class="breadcrumb" aria-label="Breadcrumb">
        <a href="index.html">Course Home</a>
        <span class="separator">›</span>
        <span class="current">Intermediate Module - Section 1: Game Architecture - Lesson 3</span>
    </nav>

    <h2>Building Flexible Game Objects with Components</h2>
    
    <div style="background-color: #f0f8ff; padding: 20px; border-radius: 10px; margin: 20px 0;">
        <p>Component systems revolutionize how we build game objects! Instead of rigid inheritance hierarchies, we compose objects from reusable components. This Entity-Component-System (ECS) pattern makes games more flexible, maintainable, and performant! 🧩🎮</p>
    </div>

    <h2>Understanding Component Systems</h2>
    
    <div style="background-color: #fff5f5; padding: 20px; border-radius: 10px; margin: 20px 0;">
        <h3>🧱 The LEGO Analogy</h3>
        <p>Think of components like LEGO blocks:</p>
        <ul>
            <li><strong>Entities:</strong> The base plate (just an ID/container)</li>
            <li><strong>Components:</strong> Individual LEGO pieces (position, health, sprite)</li>
            <li><strong>Systems:</strong> Instructions for how pieces work together</li>
            <li><strong>Composition:</strong> Combine blocks to build anything</li>
            <li><strong>Reusability:</strong> Same blocks can build different things</li>
        </ul>
    </div>

    <div class="mermaid">
    graph TD
        A["Entity-Component-System"] --> B["Entity"]
        A --> C["Components"]
        A --> D["Systems"]
        B --> E["Unique ID"]
        B --> F["Component List"]
        C --> G["Transform"]
        C --> H["Health"]
        C --> I["Renderer"]
        C --> J["Physics"]
        C --> K["AI"]
        D --> L["Movement System"]
        D --> M["Render System"]
        D --> N["Combat System"]
        D --> O["Physics System"]
    </div>

    <h2>Interactive ECS Visualizer</h2>
    
    <div class="canvas-wrapper" style="text-align: center;">
        <canvas id="ecsCanvas" width="600" height="400" style="border: 1px solid #333; background-color: #1a1a1a; display: inline-block;"></canvas>
    </div>
    <div style="text-align: center; margin-top: 10px;">
        <p>Create entities by combining components!</p>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; max-width: 600px; margin: 10px auto;">
            <button onclick="createEntity('player')">Create Player</button>
            <button onclick="createEntity('enemy')">Create Enemy</button>
            <button onclick="createEntity('powerup')">Create PowerUp</button>
            <button onclick="createEntity('particle')">Create Particle</button>
            <button onclick="createCustomEntity()">Custom Entity</button>
            <button onclick="clearAllEntities()">Clear All</button>
        </div>
        <div style="margin-top: 10px;">
            <h4>Available Components:</h4>
            <div id="componentCheckboxes" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 5px; max-width: 600px; margin: 10px auto; text-align: left;">
                <label><input type="checkbox" id="comp-transform" checked> Transform</label>
                <label><input type="checkbox" id="comp-velocity"> Velocity</label>
                <label><input type="checkbox" id="comp-health"> Health</label>
                <label><input type="checkbox" id="comp-sprite"> Sprite</label>
                <label><input type="checkbox" id="comp-collider"> Collider</label>
                <label><input type="checkbox" id="comp-ai"> AI</label>
                <label><input type="checkbox" id="comp-input"> Input</label>
                <label><input type="checkbox" id="comp-particle"> Particle</label>
            </div>
        </div>
        <div style="margin-top: 10px;">
            <label>
                <input type="checkbox" id="showSystems" checked onchange="toggleSystems()"> Show Active Systems
            </label>
            <label>
                <input type="checkbox" id="showComponents" checked onchange="toggleComponents()"> Show Components
            </label>
        </div>
        <p>Entities: <span id="entityCount">0</span> | FPS: <span id="fpsDisplay">60</span></p>
        <div id="systemsDisplay" style="margin-top: 10px; font-size: 12px;">
            Active Systems: <span id="activeSystems"></span>
        </div>
    </div>

    <script src="architecture_component_systems.js"></script>

    <h2>Basic Component System Implementation</h2>
    
    <pre class="language-python"><code>import pygame
from typing import Dict, List, Type, Optional
from dataclasses import dataclass
from abc import ABC, abstractmethod

# Component base class
class Component:
    """Base class for all components"""
    pass

# Example Components
@dataclass
class TransformComponent(Component):
    """Position and rotation component"""
    x: float = 0
    y: float = 0
    rotation: float = 0
    scale: float = 1

@dataclass
class VelocityComponent(Component):
    """Velocity component for movement"""
    vx: float = 0
    vy: float = 0
    angular_velocity: float = 0

@dataclass
class SpriteComponent(Component):
    """Visual representation component"""
    texture: pygame.Surface = None
    color: tuple = (255, 255, 255)
    layer: int = 0

@dataclass
class HealthComponent(Component):
    """Health component for damageable entities"""
    max_health: int = 100
    current_health: int = 100
    
    def take_damage(self, amount: int):
        self.current_health = max(0, self.current_health - amount)
    
    def heal(self, amount: int):
        self.current_health = min(self.max_health, self.current_health + amount)
    
    def is_alive(self) -> bool:
        return self.current_health > 0

# Entity class
class Entity:
    """Entity is just a container for components"""
    def __init__(self, entity_id: int, name: str = ""):
        self.id = entity_id
        self.name = name
        self.components: Dict[Type[Component], Component] = {}
        self.active = True
        
    def add_component(self, component: Component) -> 'Entity':
        """Add a component to this entity"""
        self.components[type(component)] = component
        return self
    
    def get_component(self, component_type: Type[Component]) -> Optional[Component]:
        """Get a component of specified type"""
        return self.components.get(component_type)
    
    def has_component(self, component_type: Type[Component]) -> bool:
        """Check if entity has a component"""
        return component_type in self.components
    
    def remove_component(self, component_type: Type[Component]):
        """Remove a component from this entity"""
        if component_type in self.components:
            del self.components[component_type]

# System base class
class System(ABC):
    """Base class for all systems"""
    def __init__(self):
        self.required_components: List[Type[Component]] = []
        self.priority = 0  # Lower values update first
    
    def get_entities(self, world: 'World') -> List[Entity]:
        """Get all entities that have required components"""
        return [entity for entity in world.entities.values()
                if entity.active and all(
                    entity.has_component(comp_type) 
                    for comp_type in self.required_components
                )]
    
    @abstractmethod
    def update(self, world: 'World', dt: float):
        """Update system logic"""
        pass

# Movement System
class MovementSystem(System):
    """System that handles entity movement"""
    def __init__(self):
        super().__init__()
        self.required_components = [TransformComponent, VelocityComponent]
        
    def update(self, world: 'World', dt: float):
        entities = self.get_entities(world)
        
        for entity in entities:
            transform = entity.get_component(TransformComponent)
            velocity = entity.get_component(VelocityComponent)
            
            # Update position based on velocity
            transform.x += velocity.vx * dt
            transform.y += velocity.vy * dt
            transform.rotation += velocity.angular_velocity * dt</code></pre>

    <h2>Advanced ECS Architecture</h2>
    
    <pre class="language-python"><code># World/Manager class
class World:
    """ECS World that manages entities and systems"""
    def __init__(self):
        self.entities: Dict[int, Entity] = {}
        self.systems: List[System] = []
        self.next_entity_id = 0
        self.component_pools: Dict[Type[Component], List[Component]] = {}
        
    def create_entity(self, name: str = "") -> Entity:
        """Create a new entity"""
        entity = Entity(self.next_entity_id, name)
        self.entities[self.next_entity_id] = entity
        self.next_entity_id += 1
        return entity
    
    def destroy_entity(self, entity_id: int):
        """Destroy an entity"""
        if entity_id in self.entities:
            # Return components to pools for reuse
            entity = self.entities[entity_id]
            for component in entity.components.values():
                self.return_to_pool(component)
            del self.entities[entity_id]
    
    def add_system(self, system: System):
        """Add a system to the world"""
        self.systems.append(system)
        self.systems.sort(key=lambda s: s.priority)
    
    def update(self, dt: float):
        """Update all systems"""
        for system in self.systems:
            system.update(self, dt)

# Entity Factory for common entity types
class EntityFactory:
    """Factory for creating common entity configurations"""
    
    @staticmethod
    def create_player(world: World, x: float, y: float) -> Entity:
        """Create a player entity"""
        player = world.create_entity("Player")
        player.add_component(TransformComponent(x, y))
        player.add_component(VelocityComponent())
        player.add_component(SpriteComponent(color=(0, 255, 0)))
        player.add_component(HealthComponent(100))
        player.add_component(ColliderComponent(32, 32, collision_layer=0))
        player.add_component(InputComponent())
        return player
    
    @staticmethod
    def create_enemy(world: World, x: float, y: float, enemy_type: str = "basic") -> Entity:
        """Create an enemy entity"""
        enemy = world.create_entity(f"Enemy_{enemy_type}")
        enemy.add_component(TransformComponent(x, y))
        enemy.add_component(VelocityComponent())
        enemy.add_component(ColliderComponent(24, 24, collision_layer=1))
        
        if enemy_type == "basic":
            enemy.add_component(HealthComponent(50))
            enemy.add_component(SpriteComponent(color=(255, 0, 0)))
            enemy.add_component(AIComponent("patrol"))
        elif enemy_type == "tank":
            enemy.add_component(HealthComponent(200))
            enemy.add_component(SpriteComponent(color=(128, 0, 0)))
            enemy.add_component(AIComponent("guard"))
        elif enemy_type == "fast":
            enemy.add_component(HealthComponent(30))
            enemy.add_component(SpriteComponent(color=(255, 128, 0)))
            enemy.add_component(AIComponent("chase"))
            velocity = enemy.get_component(VelocityComponent)
            velocity.vx = 200  # Fast movement
        
        return enemy</code></pre>

    <h2>Best Practices</h2>
    
    <div style="background-color: #fff3e0; padding: 20px; border-radius: 10px; margin: 20px 0;">
        <h3>⚡ Component System Tips</h3>
        <ul>
            <li><strong>Single Responsibility:</strong> Each component holds one type of data</li>
            <li><strong>No Logic in Components:</strong> Components are data, systems have logic</li>
            <li><strong>Composition Over Inheritance:</strong> Build entities by combining components</li>
            <li><strong>System Order Matters:</strong> Use priorities to control update order</li>
            <li><strong>Cache Component Queries:</strong> Store frequently used entity queries</li>
            <li><strong>Object Pooling:</strong> Reuse components and entities for performance</li>
            <li><strong>Event Systems:</strong> Use events for system communication</li>
            <li><strong>Data-Oriented Design:</strong> Group similar components for cache efficiency</li>
        </ul>
    </div>

    <h2>Key Takeaways</h2>
    
    <div style="background-color: #f0f8ff; padding: 20px; border-radius: 10px; margin: 20px 0;">
        <ul>
            <li>🧩 ECS separates data (Components) from logic (Systems)</li>
            <li>📦 Entities are just IDs with component collections</li>
            <li>🔄 Systems process entities with specific components</li>
            <li>🎯 Composition creates flexible game objects</li>
            <li>⚡ Performance benefits from data-oriented design</li>
            <li>🔧 Easy to add new features without changing existing code</li>
            <li>🐛 Debugging is easier with isolated systems</li>
        </ul>
    </div>

    <h2>What's Next?</h2>
    
    <p>Now that you understand component systems, next we'll explore event systems - how to create decoupled communication between game systems!</p>

    <!-- Lesson Navigation -->
    <nav class="lesson-nav" aria-label="Lesson navigation">
        <a href="architecture_scene_management.html" class="prev-lesson" aria-label="Previous lesson: Scene Management">Previous Lesson: Scene Management</a>
        <a href="architecture_event_systems.html" class="next-lesson" aria-label="Next lesson: Event Systems">Next Lesson: Event Systems</a>
    </nav>
    
    </main>
    <script src="/js/course-enhancements.js" defer></script>
</body>
</html>